@model AnalyticsViewModel
@{
    ViewData["Title"] = "Launch Analytics";
}

<div class="hero-section" style="padding: 2rem 0;">
    <h1 class="hero-title">Launch Analytics</h1>
    <p class="hero-subtitle">Statistical analysis of rocket launches from our database</p>
</div>

<div class="row g-4 mb-4">
    <div class="col-lg-3 col-md-6">
        <div class="card h-100" style="animation: fadeInUp 0.5s ease 0.1s both;">
            <div class="card-body text-center py-4">
                <div class="stat-value highlight" style="font-size: 3rem;">@Model.CurrentAnalytics.TotalLaunches</div>
                <div class="data-label">Total Launches Tracked</div>
                @if (Model.TotalLaunchesChange != 0)
                {
                    <small class="@(Model.TotalLaunchesChange > 0 ? "text-success" : "text-danger")">
                        @(Model.TotalLaunchesChange > 0 ? "+" : "")@Model.TotalLaunchesChange since yesterday
                    </small>
                }
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6">
        <div class="card h-100" style="animation: fadeInUp 0.5s ease 0.2s both;">
            <div class="card-body text-center py-4">
                <div class="stat-value" style="font-size: 3rem; color: #3b82f6;">@Model.CurrentAnalytics.UpcomingLaunches</div>
                <div class="data-label">Upcoming Launches</div>
                @if (Model.UpcomingLaunchesChange != 0)
                {
                    <small class="@(Model.UpcomingLaunchesChange > 0 ? "text-success" : "text-warning")">
                        @(Model.UpcomingLaunchesChange > 0 ? "+" : "")@Model.UpcomingLaunchesChange since yesterday
                    </small>
                }
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6">
        <div class="card h-100" style="animation: fadeInUp 0.5s ease 0.3s both;">
            <div class="card-body text-center py-4">
                <div class="stat-value success" style="font-size: 3rem;">@Model.CurrentAnalytics.SuccessfulLaunches</div>
                <div class="data-label">Successful Launches</div>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6">
        <div class="card h-100" style="animation: fadeInUp 0.5s ease 0.4s both;">
            <div class="card-body text-center py-4">
                <div class="stat-value" style="font-size: 3rem; color: #ef4444;">@Model.CurrentAnalytics.FailedLaunches</div>
                <div class="data-label">Failed Launches</div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-lg-6">
        <div class="card h-100" style="animation: fadeInUp 0.5s ease 0.5s both;">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">üè¢ Top Launch Providers</h5>
            </div>
            <div class="card-body">
                @if (Model.CurrentAnalytics.LaunchesByProvider.Any())
                {
                    @foreach (var provider in Model.CurrentAnalytics.LaunchesByProvider.Take(5))
                    {
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-1">
                                <span style="color: var(--text-primary);">@provider.Provider</span>
                                <span style="color: var(--text-secondary);">@provider.Count launches (@provider.Percentage%)</span>
                            </div>
                            <div class="progress" style="height: 8px; background: var(--bg-tertiary);">
                                <div class="progress-bar" role="progressbar" style="width: @provider.Percentage%; background: linear-gradient(90deg, #3b82f6, #60a5fa);"></div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <p class="text-center" style="color: var(--text-muted);">No provider data available</p>
                }
            </div>
            @if (!string.IsNullOrEmpty(Model.CurrentAnalytics.MostActiveProvider))
            {
                <div class="card-footer">
                    <small style="color: var(--text-muted);">
                        Most Active: <strong style="color: var(--accent-blue);">@Model.CurrentAnalytics.MostActiveProvider</strong>
                        with @Model.CurrentAnalytics.MostActiveProviderCount launches
                    </small>
                </div>
            }
        </div>
    </div>

    <div class="col-lg-6">
        <div class="card h-100" style="animation: fadeInUp 0.5s ease 0.6s both;">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">üìÖ Launches by Month</h5>
            </div>
            <div class="card-body">
                @if (Model.CurrentAnalytics.LaunchesByMonth.Any())
                {
                    <div class="d-flex flex-wrap gap-2">
                        @foreach (var month in Model.CurrentAnalytics.LaunchesByMonth.Take(12))
                        {
                            <div class="text-center p-2" style="background: var(--bg-tertiary); border-radius: 8px; min-width: 70px;">
                                <div style="font-size: 1.5rem; color: var(--text-primary); font-weight: 600;">@month.Count</div>
                                <small style="color: var(--text-muted);">@month.Month @month.Year</small>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <p class="text-center" style="color: var(--text-muted);">No monthly data available</p>
                }
            </div>
            @if (Model.CurrentAnalytics.AverageLaunchesPerMonth > 0)
            {
                <div class="card-footer">
                    <small style="color: var(--text-muted);">
                        Average: <strong style="color: var(--accent-green);">@Model.CurrentAnalytics.AverageLaunchesPerMonth</strong> launches per month
                    </small>
                </div>
            }
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-lg-6">
        <div class="card h-100" style="animation: fadeInUp 0.5s ease 0.7s both;">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">üìä 7-Day Comparison</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6">
                        <div class="p-3" style="background: var(--bg-tertiary); border-radius: 8px;">
                            <div style="font-size: 2.5rem; color: var(--accent-blue); font-weight: 700;">@Model.CurrentAnalytics.LaunchesNext7Days</div>
                            <div class="data-label">Next 7 Days</div>
                            <small style="color: var(--text-muted);">Upcoming launches</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="p-3" style="background: var(--bg-tertiary); border-radius: 8px;">
                            <div style="font-size: 2.5rem; color: var(--text-secondary); font-weight: 700;">@Model.CurrentAnalytics.LaunchesPrevious7Days</div>
                            <div class="data-label">Past 7 Days</div>
                            <small style="color: var(--text-muted);">Recent launches</small>
                        </div>
                    </div>
                </div>
                @{
                    var diff = Model.CurrentAnalytics.LaunchesNext7Days - Model.CurrentAnalytics.LaunchesPrevious7Days;
                }
                <div class="text-center mt-3">
                    @if (diff > 0)
                    {
                        <span class="badge bg-success">+@diff more launches scheduled</span>
                    }
                    else if (diff < 0)
                    {
                        <span class="badge bg-warning">@Math.Abs(diff) fewer launches scheduled</span>
                    }
                    else
                    {
                        <span class="badge bg-secondary">Same activity level</span>
                    }
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-6">
        <div class="card h-100" style="animation: fadeInUp 0.5s ease 0.8s both;">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">üìà Status Breakdown</h5>
            </div>
            <div class="card-body">
                @{
                    var total = Model.CurrentAnalytics.TotalLaunches > 0 ? Model.CurrentAnalytics.TotalLaunches : 1;
                    var successPct = Math.Round((double)Model.CurrentAnalytics.SuccessfulLaunches / total * 100, 1);
                    var upcomingPct = Math.Round((double)Model.CurrentAnalytics.UpcomingLaunches / total * 100, 1);
                    var failedPct = Math.Round((double)Model.CurrentAnalytics.FailedLaunches / total * 100, 1);
                    var tbdPct = Math.Round((double)Model.CurrentAnalytics.TbdLaunches / total * 100, 1);
                }
                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span style="color: #22c55e;">Successful</span>
                        <span>@Model.CurrentAnalytics.SuccessfulLaunches (@successPct%)</span>
                    </div>
                    <div class="progress" style="height: 8px; background: var(--bg-tertiary);">
                        <div class="progress-bar bg-success" style="width: @successPct%;"></div>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span style="color: #3b82f6;">Upcoming/Scheduled</span>
                        <span>@Model.CurrentAnalytics.UpcomingLaunches (@upcomingPct%)</span>
                    </div>
                    <div class="progress" style="height: 8px; background: var(--bg-tertiary);">
                        <div class="progress-bar bg-primary" style="width: @upcomingPct%;"></div>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span style="color: #eab308;">TBD</span>
                        <span>@Model.CurrentAnalytics.TbdLaunches (@tbdPct%)</span>
                    </div>
                    <div class="progress" style="height: 8px; background: var(--bg-tertiary);">
                        <div class="progress-bar bg-warning" style="width: @tbdPct%;"></div>
                    </div>
                </div>
                <div>
                    <div class="d-flex justify-content-between mb-1">
                        <span style="color: #ef4444;">Failed</span>
                        <span>@Model.CurrentAnalytics.FailedLaunches (@failedPct%)</span>
                    </div>
                    <div class="progress" style="height: 8px; background: var(--bg-tertiary);">
                        <div class="progress-bar bg-danger" style="width: @failedPct%;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@if (Model.HistoricalStats.Any())
{
    <div class="row">
        <div class="col-12">
            <div class="card" style="animation: fadeInUp 0.5s ease 0.9s both;">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">üìú Historical Statistics (Last 7 Days)</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Total</th>
                                    <th>Upcoming</th>
                                    <th>Successful</th>
                                    <th>Failed</th>
                                    <th>TBD</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var stat in Model.HistoricalStats)
                                {
                                    <tr>
                                        <td style="color: var(--text-primary);">@stat.Date.ToString("MMM dd, yyyy")</td>
                                        <td><span class="badge bg-secondary">@stat.TotalLaunches</span></td>
                                        <td><span class="badge bg-primary">@stat.UpcomingLaunches</span></td>
                                        <td><span class="badge bg-success">@stat.SuccessfulLaunches</span></td>
                                        <td><span class="badge bg-danger">@stat.FailedLaunches</span></td>
                                        <td><span class="badge bg-warning text-dark">@stat.TbdLaunches</span></td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer">
                    <small style="color: var(--text-muted);">
                        Statistics are saved daily. Data generated at @Model.CurrentAnalytics.GeneratedAt.ToString("MMM dd, yyyy HH:mm") UTC
                    </small>
                </div>
            </div>
        </div>
    </div>
}

<div class="text-center mt-4" style="animation: fadeInUp 0.5s ease 1s both;">
    <a asp-controller="Launch" asp-action="Index" class="btn btn-primary btn-lg">
        View All Launches
    </a>
</div>
